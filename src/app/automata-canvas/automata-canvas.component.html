<div
  class="automata-canvas-wrapper"
  [class.automata-canvas-wrapper--painting]="isPainting || isCursorOverCanvas"
>
  <div class="canvas-frame-top">
    <button
      *ngIf="!isMobileLayout && !isImmersive && !showIdleCountdown"
      #enterImmersiveBtn
      type="button"
      class="canvas-mode-handle canvas-mode-handle--enter"
      aria-label="Enter immersive mode"
      (click)="onEnterImmersiveClick()"
      (mouseenter)="onEnterImmersiveHover(true, enterImmersiveBtn)"
      (mouseleave)="onEnterImmersiveHover(false, enterImmersiveBtn)"
      (focusin)="onEnterImmersiveHover(true, enterImmersiveBtn)"
      (focusout)="onEnterImmersiveHover(false, enterImmersiveBtn)"
    >
      <lucide-icon name="eye" class="canvas-mode-handle__icon" size="16"></lucide-icon>
      <span class="canvas-mode-handle__label">Immersive mode</span>
    </button>
    <div class="canvas-top-center-handle" *ngIf="isMobileLayout">
      <button
        *ngIf="!isMobileFullScreen"
        type="button"
        class="canvas-top-chip"
        (click)="openControlsClick()"
      >
        Controls
      </button>
      <button
        *ngIf="isMobileFullScreen"
        type="button"
        class="canvas-top-chip"
        (click)="exitMobileFullScreenClick()"
      >
        Exit full screen
      </button>
    </div>
  </div>
  <div class="canvas-top-controls">
    <button
      *ngIf="isMobileLayout && !isMobileFullScreen"
      type="button"
      class="canvas-icon-button"
      aria-label="Enter full screen"
      (click)="enterMobileFullScreen()"
    >
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <polyline points="7,3 7,7 3,7"></polyline>
        <polyline points="17,3 17,7 21,7"></polyline>
        <polyline points="7,21 7,17 3,17"></polyline>
        <polyline points="17,21 17,17 21,17"></polyline>
      </svg>
    </button>
    <button
      #screenshotButton
      type="button"
      class="canvas-icon-button"
      aria-label="Export image"
      (click)="onExportImage()"
      (mouseenter)="onScreenshotHover(true, screenshotButton)"
      (mouseleave)="onScreenshotHover(false, screenshotButton)"
      (focusin)="onScreenshotHover(true, screenshotButton)"
      (focusout)="onScreenshotHover(false, screenshotButton)"
    >
      <lucide-icon name="camera" size="16"></lucide-icon>
    </button>
    <button
      *ngIf="!isMobileLayout"
      type="button"
      class="canvas-icon-button"
      [class.canvas-icon-button--active]="lensEnabled"
      aria-label="Inspector lens (Alt + scroll to zoom)"
      (click)="toggleLens()"
    >
      <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <circle cx="10.5" cy="10.5" r="5.5"></circle>
        <line x1="15" y1="15" x2="21" y2="21"></line>
      </svg>
    </button>
  </div>
  <canvas
    *ngIf="lensEnabled"
    #lensCanvas
    class="automata-lens"
    aria-hidden="true"
  ></canvas>
  <canvas
    #automataCanvasContainer
    id="automataCanvasContainer"
    class="automata-canvas"
    (pointerdown)="onCanvasPointerDown($event)"
    (pointerup)="onCanvasPointerUp($event)"
    (pointerleave)="onCanvasPointerLeave($event)"
    (pointerenter)="onCanvasPointerEnter($event)"
    (pointermove)="onCanvasPointerMove($event)"
    (wheel)="onCanvasWheel($event)"
  ></canvas>

  <button
    *ngIf="isImmersive && ruleName"
    type="button"
    class="rule-badge"
    (click)="openRuleOverlay()"
  >
    {{ ruleName }}
  </button>

  <div
    *ngIf="ruleOverlayOpen"
    class="rule-overlay-backdrop"
    (click)="closeRuleOverlay()"
  >
    <div class="rule-overlay-panel" (click)="$event.stopPropagation()">
      <div class="rule-overlay-header">
        <span class="rule-overlay-title">{{ ruleName }}</span>
        <button
          type="button"
          class="rule-overlay-close"
          aria-label="Close rule details"
          (click)="closeRuleOverlay()"
        >
          Ã—
        </button>
      </div>
      <div class="rule-overlay-body">
        <p *ngIf="ruleDescription; else noDescription">
          {{ ruleDescription }}
        </p>
        <ng-template #noDescription>
          <p class="rule-overlay-description-muted">No description available for this rule yet.</p>
        </ng-template>
      </div>
    </div>
  </div>
</div>
