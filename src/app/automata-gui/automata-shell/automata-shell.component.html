<div class="automata-app" [class.immersive]="isImmersive">
  <header #appHeader class="automata-header">
    <div class="automata-header__left" aria-label="AutomataJS">
      <img class="automata-logo" src="assets/automatajs.svg" alt="AutomataJS" />
    </div>
    <div class="automata-header__right">
      <button type="button" class="ghost-button" (click)="openAbout()">ABOUT</button>
      <button type="button" class="ghost-button" (click)="enterImmersive()">HIDE CONTROLS</button>
    </div>
  </header>

  <main #shellMain class="automata-shell">
    <section #canvasSection class="automata-shell__canvas">
      <app-automata-canvas></app-automata-canvas>
      <div class="idle-countdown" *ngIf="idleCountdownVisible">
        Switching to immersive mode in {{ idleCountdownRemaining }}s
      </div>

      <div
        #transportBar
        class="transport-tray"
        [class.transport-tray--hidden]="isImmersive && !transportVisible"
      >
        <app-automata-transport-bar
          [status]="uiState.status"
          [speed]="simulationConfig.speed"
          (mouseenter)="onImmersiveTransportInteraction()"
          (focusin)="onImmersiveTransportInteraction()"
          (play)="onPlay()"
          (pause)="onPause()"
          (reset)="onReset()"
          (step)="onStep()"
          (speedChange)="onSpeedChange($event)"
        ></app-automata-transport-bar>
      </div>

      <button
        *ngIf="isImmersive"
        class="immersive-handle immersive-handle--right"
        type="button"
        aria-label="Show control panel"
        [attr.aria-pressed]="panelOpen ? 'true' : 'false'"
        (click)="toggleControls()"
        (mouseenter)="onImmersiveHandleHover($event, true, 'control')"
        (mouseleave)="onImmersiveHandleHover($event, false, 'control')"
        (focusin)="onImmersiveHandleHover($event, true, 'control')"
        (focusout)="onImmersiveHandleHover($event, false, 'control')"
      >
        <span class="immersive-handle__icon-stack" aria-hidden="true">
          <lucide-icon name="settings" size="16"></lucide-icon>
        </span>
      </button>

      <button
        #bottomHandle
        *ngIf="isImmersive && !transportVisible"
        class="immersive-handle immersive-handle--bottom"
        type="button"
        aria-label="Show transport controls"
        (click)="showTransport()"
        (mouseenter)="onImmersiveHandleHover($event, true, 'transport')"
        (mouseleave)="onImmersiveHandleHover($event, false, 'transport')"
        (focusin)="onImmersiveHandleHover($event, true, 'transport')"
        (focusout)="onImmersiveHandleHover($event, false, 'transport')"
      >
        <span class="immersive-handle__icon-row" aria-hidden="true">
          <lucide-icon name="play" size="16"></lucide-icon>
        </span>
      </button>
    </section>

    <aside #controlPanel class="automata-shell__panel" *ngIf="panelOpen && !isImmersive">
      <div class="panel__header">
        <p class="panel__eyebrow">Control center</p>
      </div>
      <div class="panel__body">
        <app-automata-control
          [config]="simulationConfig"
          [status]="uiState.status"
          [uiState]="uiState"
          (configChange)="onConfigChange($event)"
          (statusChange)="onStatusChange($event)"
          (uiStateChange)="onUiStateChange($event)"
        ></app-automata-control>
      </div>
    </aside>
  </main>

  <div class="automata-shell__about" *ngIf="isAboutOpen">
    <div class="about-card" role="dialog" aria-modal="true" aria-label="About AutomataJS">
      <button type="button" class="about-card__close" (click)="closeAbout()">
        <mat-icon>close</mat-icon>
      </button>
      <h3>About AutomataJS</h3>
      <p>
        AutomataJS is a GPU-accelerated playground for iterating on cellular automata without touching GLSL. Every
        simulation runs inside shaders so you can pause, recolor, zoom, and resume at full speed.
      </p>
      <p>
        Responsive controls, touch-friendly sliders, and curated presets help you explore emergent behavior on desktop or
        mobile. Save palettes, tweak rules, and capture high-resolution stills as you experiment.
      </p>
      <a
        class="about-card__link"
        href="https://github.com/bisignam/automatajs"
        target="_blank"
        rel="noopener"
      >
        View project on GitHub
      </a>
    </div>
  </div>
</div>
